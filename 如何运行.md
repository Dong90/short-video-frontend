# Postiz 如何运行起来

## 前置条件

- 已安装 **Docker Desktop**，并处于运行状态
- 本机可访问 Docker Hub（或已配置可用的镜像源）

---

## 一、直接启动（推荐）

在项目根目录执行：

```bash
cd /Users/shixiaocai/Desktop/chuangye/duanju/github/postiz-app
docker compose up -d
```

等待 **1～2 分钟**（等 PostgreSQL、Redis、Temporal、Elasticsearch 都就绪），然后：

- 浏览器访问：**http://localhost:4007**
- 首次访问会进入登录/注册页，注册后即可使用

---

## 二、若拉取镜像报错（如 163 镜像解析失败）

错误类似：`lookup hub-mirror.c.163.com: no such host` 或 `failed to resolve reference`。

**处理：** 让 Docker 不再使用无法访问的镜像站。

1. 打开 **Docker Desktop** → 右上角 **齿轮 (Settings)** → **Docker Engine**
2. 查看 JSON 里是否有 `"registry-mirrors": ["https://hub-mirror.c.163.com"]`
3. **删掉** `registry-mirrors` 整段，或改成你可用的镜像（如 `https://docker.1ms.run`）
4. 点 **Apply and restart**，等 Docker 重启完成
5. 再执行：`docker compose up -d`

---

## 三、先拉镜像再启动（网络较慢时）

```bash
cd /Users/shixiaocai/Desktop/chuangye/duanju/github/postiz-app
docker compose pull
docker compose up -d
```

---

## 四、确认服务都起来

```bash
docker compose ps
```

期望看到类似（均为 **Up** 或 **healthy**）：

- **postiz**（主应用）
- **postiz-postgres**、**postiz-redis**
- **temporal**、**temporal-postgresql**、**temporal-elasticsearch**
- **temporal-ui**（可选，Temporal 管理界面）
- **spotlight**（可选）

若只有 postiz、postiz-postgres、postiz-redis 在跑，而 **temporal 没起来**，访问 4007 会 502。此时需要确保 `docker compose up -d` 拉齐并启动了所有服务（不要只启动部分）。

---

## 五、访问地址

| 服务       | 地址                      |
|------------|---------------------------|
| Postiz 前端 | http://localhost:4007     |
| Temporal UI | http://localhost:8080     |
| Spotlight  | http://localhost:8969     |

---

## 六、常见问题

### 1. 打开 4007 出现 502 Bad Gateway

- **原因**：容器内后端连不上 Temporal，未监听 3000 端口。
- **处理**：执行 `docker compose ps`，确认 **temporal**、**temporal-postgresql**、**temporal-elasticsearch** 都在运行；若未运行，执行 `docker compose up -d` 等 1～2 分钟再试；然后可执行 `docker compose restart postiz` 重启主应用。

### 2. 拉取 temporal 相关镜像失败

- 若报错里出现 `temporalio/admin-tools`，本项目已在 `docker-compose.yml` 中注释掉 **temporal-admin-tools**，无需该镜像即可运行 Postiz。
- 若其他镜像拉取失败，按「二、若拉取镜像报错」检查并修改 Docker 镜像配置。

### 3. Docker 凭证错误（error getting credentials）

- 打开 Docker Desktop → **Settings** → **Resources** → **Advanced**
- 取消勾选 **Use Docker Credential Helper**
- **Apply & Restart**

---

## 七、停止与重启

```bash
# 停止所有服务
docker compose down

# 再次启动
docker compose up -d
```

总结：在项目目录执行 **`docker compose up -d`**，等 1～2 分钟后访问 **http://localhost:4007** 即可使用；若遇 502，先保证 temporal 相关服务都已 Up。
